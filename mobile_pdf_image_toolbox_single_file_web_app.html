<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mobile PDF & Image Toolbox</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      font-family: Arial, sans-serif;
      background: #f9fafb;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      overflow-x: hidden;
    }
    header {
      background: linear-gradient(135deg, #4f46e5, #3b82f6);
      color: white;
      text-align: center;
      padding: 1rem;
      width: 100%;
      border-radius: 0 0 1rem 1rem;
      box-sizing: border-box;
    }
    main {
      flex: 1;
      width: 100%;
      max-width: 420px;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      box-sizing: border-box;
    }
    .card {
      background: white;
      border-radius: 1rem;
      padding: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    select, input, button {
      padding: 0.75rem;
      border-radius: 0.75rem;
      border: 1px solid #d1d5db;
      font-size: 1rem;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
    }
    .file-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: flex-start;
    }
    .thumb {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .hidden { display: none; }
    progress {
      width: 100%;
      height: 1rem;
      border-radius: 0.75rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>ðŸ“„ Mobile PDF & Image Toolbox</h1>
  </header>
  <main>
    <div class="card">
      <label for="operation">Choose Operation:</label>
      <select id="operation">
        <option value="images-to-pdf">Images â†’ PDF</option>
        <option value="merge-pdf">Merge PDFs</option>
        <option value="pdf-to-images">PDF â†’ Images</option>
        <option value="split-pdf">Split PDF</option>
        <option value="convert-images">Convert Images</option>
      </select>
      <input type="file" id="file-input" multiple />
      <div id="image-format-group" class="hidden">
        <label for="image-format">Output Image Format:</label>
        <select id="image-format">
          <option value="image/png">PNG</option>
          <option value="image/jpeg">JPEG</option>
          <option value="image/webp">WEBP</option>
        </select>
      </div>
      <div id="page-range-group" class="hidden">
        <label for="page-range">Page numbers (e.g. 1,3-5):</label>
        <input type="text" id="page-range" placeholder="Enter page numbers" />
      </div>
      <div class="file-list" id="file-list"></div>
      <progress id="progress" value="0" max="100" class="hidden"></progress>
      <button id="run-btn">Run</button>
      <div id="output"></div>
    </div>
  </main>
  <script>
    const operation = document.getElementById('operation');
    const fileInput = document.getElementById('file-input');
    const fileList = document.getElementById('file-list');
    const runBtn = document.getElementById('run-btn');
    const output = document.getElementById('output');
    const imgFormatGroup = document.getElementById('image-format-group');
    const pageRangeGroup = document.getElementById('page-range-group');
    const progress = document.getElementById('progress');

    let selectedFiles = [];

    operation.addEventListener('change', () => {
      imgFormatGroup.classList.toggle('hidden', operation.value !== 'convert-images' && operation.value !== 'pdf-to-images');
      pageRangeGroup.classList.toggle('hidden', !(operation.value === 'pdf-to-images' || operation.value === 'split-pdf'));
    });

    fileInput.addEventListener('change', (e) => {
      selectedFiles = Array.from(e.target.files);
      renderFileList();
    });

    function renderFileList() {
      fileList.innerHTML = '';
      selectedFiles.forEach((file, idx) => {
        if(file.type.startsWith('image/')){
          const img = document.createElement('img');
          img.src = URL.createObjectURL(file);
          img.className = 'thumb';
          img.draggable = true;
          img.dataset.index = idx;
          fileList.appendChild(img);
        } else {
          const div = document.createElement('div');
          div.textContent = file.name;
          div.style.padding = '0.5rem';
          div.style.border = '1px solid #ddd';
          div.style.borderRadius = '1rem';
          div.draggable = true;
          div.dataset.index = idx;
          fileList.appendChild(div);
        }
      });
      initDragAndDrop();
    }

    function initDragAndDrop() {
      let dragged;
      fileList.querySelectorAll('[draggable=true]').forEach(el => {
        el.addEventListener('dragstart', e => { dragged = el; });
        el.addEventListener('dragover', e => { e.preventDefault(); });
        el.addEventListener('drop', e => {
          e.preventDefault();
          if(dragged && dragged !== el){
            const oldIndex = +dragged.dataset.index;
            const newIndex = +el.dataset.index;
            const moved = selectedFiles.splice(oldIndex, 1)[0];
            selectedFiles.splice(newIndex, 0, moved);
            renderFileList();
          }
        });
      });
    }

    runBtn.addEventListener('click', async () => {
      output.innerHTML = '';
      progress.classList.remove('hidden');
      progress.value = 10;

      if(operation.value === 'images-to-pdf'){
        const pdfDoc = await PDFLib.PDFDocument.create();
        for (let file of selectedFiles) {
          const imgBytes = await file.arrayBuffer();
          let img;
          if (file.type === 'image/png') img = await pdfDoc.embedPng(imgBytes);
          else img = await pdfDoc.embedJpg(imgBytes);
          // Use mobile device size (portrait 1080x1920)
          const page = pdfDoc.addPage([1080, 1920]);
          page.drawImage(img, {x:0,y:0,width:1080,height:1920});
        }
        const pdfBytes = await pdfDoc.save();
        downloadFile(pdfBytes, 'output.pdf', 'application/pdf');
      }

      progress.value = 100;
    });

    function downloadFile(bytes, filename, type){
      const blob = new Blob([bytes], {type});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.click();
    }
  </script>
</body>
</html>
